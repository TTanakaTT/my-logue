このリポジトリは SvelteKit (Vite + Svelte 5 + TypeScript) による選択式ローグライトゲームです。開発において以下の方針/約束を守ってください。

## 開発フロー

| シナリオ             | コマンド       | 内容                                          |
| -------------------- | -------------- | --------------------------------------------- |
| 依存取得             | `pnpm install` | 依存ライブラリ取得                            |
| 開発サーバ           | `pnpm dev`     | Vite 開発サーバ (Playwright E2E もこれに依存) |
| 型+Svelte チェック   | `pnpm check`   | `svelte-check` による型/コンポーネント検証    |
| Lint & Prettier 検証 | `pnpm lint`    | Prettier 差分 + ESLint                        |
| 自動整形             | `pnpm format`  | Prettier で一括整形                           |

### Commit / PR 前のチェック (必須)

1. `pnpm format` を実行し整形差分を確定
2. `pnpm lint` で ESLint / Prettier チェックが全てパス
3. `pnpm check` で型エラーが無いこと
4. 大きなゲームバランス変更時は `README.md` か、別途 `docs/` (未作成なら提案) への反映を検討

CI (将来追加/拡張する場合) の想定シーケンス例: format チェック → lint → type check。

## リポジトリ構造ガイド

- `src/lib/domain/entities/` : ドメインのエンティティ。
- `src/lib/domain/services/` : エンティティ間協調ロジック。純粋関数志向を優先しつつランダム性/状態遷移はここに集中。
- `src/lib/data/` : 定数・CSV などゲームバランス用のデータソース。
- `src/lib/presentation/` : Svelte コンポーネント層。UI 状態は必要最小限を保持し、ゲーム進行は domain/services を呼ぶ形に。
- `src/routes/` : ページルーティング (SvelteKit)。
- `tests-e2e/` : Playwright テスト。

### データ変更

CSV (`characters.csv`, `rewards.csv` 等) を変更する場合は:

1. 破壊的変更 (列追加/削除) 時に読み込み側 Repository (`src/lib/data/repositories/*Repository.ts`) を同期更新

## コードスタイル / 設計指針

1. TypeScript で型を明確化 (特にエンティティ境界とサービス戻り値)。`any` は避ける。
2. svelteファイルでstyleタグは使用せず、tailwindcssのユーティリティクラスを使用する。
3. 1 ファイルの責務を狭く保つ。
4. 同等/ほぼ同等なコードが現れたら抽出し、共通化することを検討する。重複ロジック、二重定義は早期に共通化する。
5. 整理されたコードを優先して、既存コードの踏襲は最小限にし、破壊的な変更も実施する。
6. 不要になったコード/型/データ (未使用の関数・変数・コンポーネント・CSV 列等) は速やかに削除しコメントアウト放置を避ける。
7. 共通化したユーティリティはドメイン層なら `domain/services/` または `domain/entities/`、UI 専用なら `presentation/components/` / `presentation/utils/` へ配置し、意図が分かる命名 (動詞 + 対象 など) にする。

### コメント / ドキュメント

- 複雑な計算 (ダメージ、成長ロジック等) は数式や確率根拠を JSDoc で簡潔に記述。
- 意図を失いやすいマジックナンバーは禁止。`const` 命名で意味付け。

## 将来の改善候補

- docs/ ディレクトリ新設 (ゲーム内計算式一覧)
- i18n 基盤 (英語/日本語切替)
- 報酬の表示をnameとsvgとdescriptionにしてください。nameは全て鉱石の名前にして、descriptionは効果の説明にしてください。name、descriptionはreward.csvに追加してください。svgは作成してください。
- 洞察でアクションを開示をした相手を倒した際は、対象のアクションが報酬に含まれるようにしてください。洞察ずみのactionは色が変わるようにしてください。
- プレイヤーの名前をつけれるようにして、初期値としてsrc/lib/data/consts/mineral.csv のカタカナからランダムに選択するようにしてください。
- ゲームオーバー時に、ゲームオーバー時のステータスで対象キャラクターを仲間にできるようにして、3人まで仲間にできるようにしてください。
- ゲーム開始時に仲間を1人選択できるようにしてください。
- プレイヤーの初期値パターンを複数用意して、ランダムに選択するようにしてください。
- 階層でどのようなパターンで敵が出現するかをcsvで管理できるようにしてください。

## ライセンス / 著作権

外部アセットを追加する際はライセンス表記を README に追記。生成画像/音声は出典と生成プロンプトをメタデータで保持。

このリポジトリは SvelteKit (Vite + Svelte 5 + TypeScript) による選択式ローグライトゲームです。開発において以下の方針/約束を守ってください。

## 開発フロー

| シナリオ             | コマンド       | 内容                                          |
| -------------------- | -------------- | --------------------------------------------- |
| 依存取得             | `pnpm install` | 依存ライブラリ取得                            |
| 開発サーバ           | `pnpm dev`     | Vite 開発サーバ (Playwright E2E もこれに依存) |
| 型+Svelte チェック   | `pnpm check`   | `svelte-check` による型/コンポーネント検証    |
| Lint & Prettier 検証 | `pnpm lint`    | Prettier 差分 + ESLint                        |
| 自動整形             | `pnpm format`  | Prettier で一括整形                           |

### Commit / PR 前のチェック (必須)

1. `pnpm format` を実行し整形差分を確定
2. `pnpm lint` で ESLint / Prettier チェックが全てパス
3. `pnpm check` で型エラーが無いこと
4. 大きなゲームバランス変更時は `README.md` か、別途 `docs/` (未作成なら提案) への反映を検討

CI (将来追加/拡張する場合) の想定シーケンス例: format チェック → lint → type check。

### データ変更

CSV (`characters.csv`, `rewards.csv` 等) を変更する場合は:

1. 破壊的変更 (列追加/削除) 時に読み込み側 Repository (`src/lib/data/repositories/*Repository.ts`) を同期更新

## コードスタイル / 設計指針

3. 同等/ほぼ同等なコードが現れたら抽出し、共通化することを検討する。重複ロジック、二重定義は早期に共通化する。
4. 整理されたコードを優先して、既存コードの踏襲は最小限にし、破壊的な変更も実施する。
5. 不要になったコード/型/データ (未使用の関数・変数・コンポーネント・CSV 列等) は速やかに削除しコメントアウト放置を避ける。

### CSS / スタイルルール

- レイアウト・スペーシングなどのマジックナンバーは極力避け、共通トークン化（ユーティリティ化/変数化）を検討する。

### コメント / ドキュメント

- 複雑な計算 (ダメージ、成長ロジック等) は数式や確率根拠を JSDoc で簡潔に記述。
- 意図を失いやすいマジックナンバーは禁止。`const` 命名で意味付け。

## LLM 生成コードのガードレール

構造の崩壊や設計逸脱を防ぐため、LLM による生成・修正時は以下を厳守してください。

### 層と責務の境界

- domain（`src/lib/domain`）: エンティティ/純粋サービス（副作用なし）。状態遷移や乱数は services に集約。
- data（`src/lib/data`）: 定数/CSV/Repository。CSV 変更時は該当 Repository を同一 PR で同期更新。
- presentation（`src/lib/presentation`）: UI のみ。進行は domain/services を呼ぶ。UI にビジネスロジックを書かない。
- routes（`src/routes`）: ページ構成のみ。ビジネスロジック禁止。

### 依存関係ルール

- 依存方向は data → domain → presentation の一方向。逆流（presentation → data 直接参照）は禁止。
- 共有ユーティリティは層に応じた場所へ配置（domain 用/ UI 専用を混在させない）。

### 型・命名・ファイル配置

- `any` 禁止。公開型や関数シグネチャ変更は全利用箇所を同一 PR で更新。
- 1 ファイル 1 責務。重複は抽出して共通化。命名は意図が伝わるように（動詞+対象 等）。
- インポートは既存のエイリアス（`$lib/...`）方針に合わせる。

### UI / スタイル（Tailwind）

- `<style>` タグ禁止。Tailwind ユーティリティのみ使用。
- 重要度指定（`!important`/Tailwind の `!`）は原則禁止。
- 色は `@theme` の `--color-*` 変数を定義して `text-*` 等で参照（直書き禁止）。
- アイコンは `material-symbols` を使用。

### データ/CSV の扱い

- スキーマ変更（列追加/削除）は Repository を必ず同期更新し、破壊変更時は README/docs の更新も検討。

### 変更・PR チェックリスト（LLM 用）

2. 既存の型/関数/構造に整合。
3. CSV 変更時は Repository 同期・README/docs 更新を確認。更新。

### 禁止事項

- 依存方向の逆流、UI へのビジネスロジック混在、直接 DOM 操作の埋め込み。
- `any`、未使用コードの残置、色の直書き、任意 CSS の直付け、`<style>` タグ使用。

## 将来の改善候補

- docs/ ディレクトリ新設 (ゲーム内計算式一覧)
- i18n 基盤 (英語/日本語切替)
- 報酬の表示をnameとsvgとdescriptionにしてください。nameは全て鉱石の名前にして、descriptionは効果の説明にしてください。name、descriptionはreward.csvに追加してください。svgは作成してください。
- 洞察でアクションを開示をした相手を倒した際は、対象のアクションが報酬に含まれるようにしてください。洞察ずみのactionは色が変わるようにしてください。
- プレイヤーの名前をつけれるようにして、初期値としてsrc/lib/data/consts/mineral.csv のカタカナからランダムに選択するようにしてください。
- ゲームオーバー時に、ゲームオーバー時のステータスで対象キャラクターを仲間にできるようにして、3人まで仲間にできるようにしてください。
- ゲーム開始時に仲間を1人選択できるようにしてください。
- プレイヤーの初期値パターンを複数用意して、ランダムに選択するようにしてください。
- 階層でどのようなパターンで敵が出現するかをcsvで管理できるようにしてください。
- JSDoc の形式でコメントを追加

## ライセンス / 著作権

外部アセットを追加する際はライセンス表記を README に追記。生成画像/音声は出典と生成プロンプトをメタデータで保持。
